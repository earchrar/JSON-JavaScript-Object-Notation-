<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" charset="width=device-width initial-scale=1.0" />
        <title>Food Finder - Fetch</title>
        <!-- Font Awesome css1  -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" rel="stylesheet" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

        <style type="text/css">

            *{
                box-sizing: border-box;
            }

            body{
                background-color: #f4f4f4;

                display: flex;
                justify-content: center;
            }

            .container{
                max-width: 60vw;

                display: flex;
                justify-content: center;
                align-items: center;
                flex-direction: column;
            }

            form{
                margin-bottom: 10px;
            }

            input,button{
                font-size: 14px;
                padding: 8px 10px;
            }

            input[type="text"]{
                width: 400px;
            }

            input[type="text"]:focus{
                outline: none;
            }

            img{
                width: 200px;
                height: 150px;
                border: 5px solid #fff;
                border-radius: 5px;

                object-fit: cover;
            }

            .displaytwo{
                display: grid;
                grid-template-columns: repeat(5,1fr);
                gap: 20px;
            }

            .displaytwo .foodresult{
                width: 150px;
                height: 150px;
                text-align: center;

                position: relative;
            }

            .displaytwo .foodresult img{
                width: 100%;
                height: 100%;
                border: 5px solid #eee;
            }

            .foodinfo{
                width: 100%;
                height: 100%;
                background-color: rgba(0,0,0,0.3);
                color: #fff;

                position: absolute;
                left: 0;
                top: 0;

                display: flex;
                justify-content: center;
                align-items: center;

                opacity: 0;

                transition: opacity .5s ease-in-out;
            }

            .foodinfo:hover{
                opacity: 1;
            }

            .random-btn{
                margin-bottom: 10px;
            }

        </style>

    </head>
    <body>

        <div class="container">

            <h1>Food Finder</h1>

            <div class="card">
                <form id="form" action="" method="">
                    <div>
                        <input type="text" id="search" name="search" class="form-control" placeholder="Search..." />
                        <button type="submit" class="searchbtn" id="searchbtn"><i class="fas fa-search"></i> Search</button>
                    </div>
                </form>
            </div>

            <button type="button" class="random-btn" id="random-btn">Get Random Food</button>

            <div id="header"></div>
            <div id="displayone"></div>
            <div id="displaytwo" class="displaytwo"></div>

        </div>


        <!-- jQuery js1 -->
        <script src="./libs/jquery-3.7.1.min.js" type="text/javascript"></script>
        <!-- Axios api  -->
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <script type="text/javascript">

            // GET UI 

            const getrandombtn = document.getElementById("random-btn");
            const getheader = document.getElementById("header");
            const getdisplayone = document.getElementById("displayone");

            const getform = document.getElementById("form");
            const getsearchbtn = document.getElementById("search");
            const getdisplaytwo = document.getElementById("displaytwo");

            getrandombtn.addEventListener("click",getrandomfood);

            function getrandomfood(){

                // clear displaytwo list 
                getdisplaytwo.innerHTML = "";

                // Lookup a single random meal
                const url = `https://www.themealdb.com/api/json/v1/1/random.php`;

                fetch(url).then(response=>response.json()).then(response=>{
                    // console.log(response);
                    // console.log(response.meals[0]);

                    let food = response.meals[0];
                    // console.log(food);

                    getsettrtodom(food);


                }).catch((err)=>console.log(err));

            }

            function getsettrtodom(food){

                // console.log(food);

                const ingredient = [];
                
                for(let x = 1; x <= 20;x++){

                    // console.log(x);

                    // ingredient.push(`${food[`strIngredient${x}`]} = ${food[`strMeasure${x}`]}`);

                    if(`${food[`strIngredient${x}`]}`){
                        ingredient.push(`${food[`strIngredient${x}`]} = ${food[`strMeasure${x}`]}`);
                    }

                }

                console.log(ingredient);


                getdisplayone.innerHTML = `

                    <h3 style="text-align:justify;text-indent:20px;">${food.strArea}</h3>
                    <div>
                        <img src="${food.strMealThumb}" alt="${food.strArea}" />
                    </div>

                    <div>
                        <p style="text-align:justify;">${food.strInstructions}</p>
                        <h3>Main Ingredients</h3>
                    </div>

                    <ol>
                        ${ingredient.map(ingredient=>`<li>${ingredient}</li>`).join("")}
                    </ol>

                `;

            }

            getform.addEventListener("submit",searchfood);

            function searchfood(e){

                // clear displayone list 
                getdisplayone.innerHTML = "";

                e.preventDefault();

                const getval = getsearchbtn.value;
                console.log(getval);

                if(getval.trim()){

                    // Search meal by name
                    const url = `https://www.themealdb.com/api/json/v1/1/search.php?s=${getval}`;
                    // console.log(url);

                    axios({
                        method:"GET",
                        url:url
                    }).then(response=>{
                        // console.log(response.data);
                        // console.log(response.data.meals);

                        getheader.innerHTML = "";

                        if(response.data.meals === null){
                            getheader.innerHTML = `<p>There is no data. Try Again Sir.</p>`;
                        }else{
                            
                            getdisplaytwo.innerHTML = response.data.meals.map(food=>`
                                <div class="foodresult">
                                    <img src="${food.strMealThumb}" alt="${food.strMeal}" />
                                    <div class="foodinfo" data-idmeal="${food.idMeal}">
                                        <h5>${food.strMeal}</h5>
                                    </div>
                                </div>
                            `).join("");
                        }


                    }).catch(err=>console.log(err));
                    

                }else{
                    alert("Please enter you a search value !!!")
                }

            }

            getdisplaytwo.addEventListener("click",e=>{

                // console.log(e.target);
                // console.log(e.composedPath());// (9)Â [h5, div.foodinfo, div.foodresult, div#displaytwo.displaytwo, div.container, body, html, document, Window]

                const getfoodresult = e.composedPath().find(item=>{

                    // console.log(item);
                    // console.log(item.classList);

                    if(item.classList){
                        return item.classList.contains("foodinfo");
                    }else{
                        return false;
                    }

                });

                // console.log(getfoodresult);

                if(getfoodresult){
                    
                    const getfoodinfo = getfoodresult.getAttribute("data-idmeal");
                    // console.log(getfoodinfo);

                    getfoodid(getfoodinfo);

                }

            });

            function getfoodid(id){

                // console.log(id);

                // Lookup full meal details by id
                const url = `https://www.themealdb.com/api/json/v1/1/lookup.php?i=${id}`;
                // console.log(url);

                $.ajax({
                    method:"GET",
                    url:url,
                    dataType: "json"
                }).done((data)=>{
                    // console.log(data);

                    const foodresult = data.meals[0];
                    getsettrtodom(foodresult);
    

                }).fail(err=>console.log(err));

            }







        </script>
        

    </body>
</html>